<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Data Sheet</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root{
      --primary:#2563eb;
      --bg:#0b1020;
      --card:#121a2b;
      --text:#e6edf3;
      --muted:#a0b3c5;
      --radius:12px;
      --font:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    body{margin:0;background:#0b1020;color:var(--text);font:15px var(--font);}
    header{background:#121a2b;padding:12px;font-weight:700;font-size:18px;color:var(--text);}
    main{display:grid;grid-template-columns:300px 1fr;gap:16px;padding:16px;max-width:1300px;margin:auto;}
    .card{background:#121a2b;border-radius:var(--radius);padding:16px;box-shadow:0 4px 20px rgba(0,0,0,0.4);}
    h2{margin:0 0 10px 0;font-size:17px;}
    label{font-size:14px;color:var(--muted);}
    input,select,button{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:#0c1426;color:var(--text);}
    button{cursor:pointer;font-weight:600;background:var(--primary);border:none;}
    button.danger{background:#ef4444;}
    button.success{background:#16a34a;}
    .stack{display:flex;flex-direction:column;gap:8px;margin-bottom:12px;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{padding:8px;text-align:left;border:1px solid rgba(255,255,255,0.1);}
    th{font-weight:bold;background:#1d2a4d;color:#fff;}
    tfoot td{font-weight:bold;background:#0e1a33;color:#ffd700;}
  </style>
</head>
<body>
  <header>ðŸ“Š Smart Data Sheet</header>
  <main>
    <!-- Sidebar -->
    <section class="card">
      <h2>Create Column</h2>
      <div class="stack">
        <label>Column Name</label>
        <input id="colName" placeholder="e.g. Amount, Name" />
        <label>Type</label>
        <select id="colType">
          <option value="text">Text</option>
          <option value="number">Number</option>
          <option value="date">Date</option>
        </select>
        <button id="addColBtn">âž• Add Column</button>
      </div>

      <h2>Heading Style</h2>
      <div class="stack">
        <label>Heading Color</label>
        <input type="color" id="headingColor" value="#ffffff"/>
        <label>Background Color</label>
        <input type="color" id="headingBg" value="#1d2a4d"/>
        <label>Font Size (px)</label>
        <input type="number" id="headingSize" min="12" max="28" value="16"/>
      </div>

      <h2>Math Operations</h2>
      <div class="stack">
        <label>Choose Number Column</label>
        <select id="mathColumn"></select>
        <label>Operation</label>
        <select id="mathOp">
          <option value="sum">Total (Auto)</option>
          <option value="add">+ Addition</option>
          <option value="sub">- Subtraction</option>
          <option value="mul">Ã— Multiplication</option>
          <option value="div">Ã· Division</option>
          <option value="perc">% Percentage</option>
        </select>
        <input type="number" id="mathValue" placeholder="Enter value (optional)" />
        <button id="applyMath">Apply</button>
        <div id="mathResult" style="margin-top:8px;font-weight:bold;color:#0ea5e9"></div>
      </div>

      <h2>Export / Import</h2>
      <div class="stack">
        <button id="exportCSV">Export CSV</button>
        <button id="exportXLSX">Export Excel</button>
        <button id="exportJSON">Export JSON</button>
        <input type="file" id="importJSON" accept="application/json"/>
      </div>
    </section>

    <!-- Main Content -->
    <section class="card">
      <h2>Data Entry</h2>
      <form id="dataForm" class="stack"></form>
      <button class="success" id="addRow">âž• Add Record</button>

      <h2>Records</h2>
      <table id="dataTable"></table>
    </section>
  </main>

  <script>
    let schema = [];
    let data = [];

    const el = id => document.getElementById(id);

    function save(){localStorage.setItem("sheet_schema",JSON.stringify(schema));localStorage.setItem("sheet_data",JSON.stringify(data));}
    function load(){schema=JSON.parse(localStorage.getItem("sheet_schema")||"[]");data=JSON.parse(localStorage.getItem("sheet_data")||"[]");}

    // Render Form
    function renderForm(){
      const form = el("dataForm"); form.innerHTML="";
      schema.forEach(col=>{
        const wrap=document.createElement("div");wrap.className="stack";
        const label=document.createElement("label");label.textContent=col.name+" ("+col.type+")";
        const input=document.createElement("input"); input.name=col.name;
        input.type=col.type==="number"?"number":col.type==="date"?"date":"text";
        wrap.appendChild(label); wrap.appendChild(input); form.appendChild(wrap);
      });
    }

    // Render Table
    function renderTable(){
      const table=el("dataTable"); table.innerHTML="";
      if(schema.length===0){table.textContent="Add columns first.";return;}
      const thead=document.createElement("thead"); const tr=document.createElement("tr");
      schema.forEach(c=>{
        const th=document.createElement("th"); th.textContent=c.name;
        th.style.color=el("headingColor").value;
        th.style.backgroundColor=el("headingBg").value;
        th.style.fontSize=el("headingSize").value+"px";
        tr.appendChild(th);
      });
      tr.appendChild(document.createElement("th")).textContent="Actions";
      thead.appendChild(tr); table.appendChild(thead);

      const tbody=document.createElement("tbody");
      data.forEach((row,i)=>{
        const tr=document.createElement("tr");
        schema.forEach(c=>{
          const td=document.createElement("td");
          td.contentEditable=true; td.textContent=row[c.name]||"";
          td.onblur=()=>{row[c.name]=td.textContent;save();};
          tr.appendChild(td);
        });
        const tdAct=document.createElement("td");
        const del=document.createElement("button");del.textContent="Delete";del.className="danger";
        del.onclick=()=>{data.splice(i,1);save();renderTable();};
        tdAct.appendChild(del);tr.appendChild(tdAct);
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      // Summary row
      const tfoot=document.createElement("tfoot"); const sumTr=document.createElement("tr");
      schema.forEach(c=>{
        const td=document.createElement("td");
        if(c.type==="number"){
          const total=data.reduce((s,r)=>s+(parseFloat(r[c.name])||0),0);
          td.textContent="Total: "+total;
        }
        sumTr.appendChild(td);
      });
      sumTr.appendChild(document.createElement("td")); tfoot.appendChild(sumTr); table.appendChild(tfoot);

      refreshMathColumns();
    }

    // Add column
    el("addColBtn").onclick=()=>{
      const name=el("colName").value.trim(); if(!name) return alert("Enter column name");
      schema.push({name,type:el("colType").value});
      el("colName").value=""; save(); renderForm(); renderTable();
    };

    // Add row
    el("addRow").onclick=e=>{
      e.preventDefault();
      const form=el("dataForm"); const row={};
      schema.forEach(c=>{const input=form.querySelector(`[name="${c.name}"]`);row[c.name]=input.value;});
      data.push(row); save(); renderTable(); form.reset();
    };

    // Export / Import
    function download(blob,name){const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download=name;a.click();}
    el("exportCSV").onclick=()=>{
      const cols=schema.map(c=>c.name); const rows=data.map(r=>cols.map(c=>r[c]||""));
      const csv=[cols.join(","),...rows.map(r=>r.join(","))].join("\n");
      download(new Blob([csv],{type:"text/csv"}),"data.csv");
    };
    el("exportXLSX").onclick=()=>{const ws=XLSX.utils.json_to_sheet(data);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Data");XLSX.writeFile(wb,"data.xlsx");};
    el("exportJSON").onclick=()=>{download(new Blob([JSON.stringify({schema,data},null,2)],{type:"application/json"}),"project.json");};
    el("importJSON").onchange=async e=>{
      const f=e.target.files[0]; if(!f) return;
      const obj=JSON.parse(await f.text()); schema=obj.schema||[]; data=obj.data||[];
      save(); renderForm(); renderTable();
    };

    // Math
    function refreshMathColumns(){
      const sel=el("mathColumn"); sel.innerHTML="";
      schema.filter(c=>c.type==="number").forEach(c=>{
        const o=document.createElement("option");o.value=c.name;o.textContent=c.name;sel.appendChild(o);
      });
    }
    el("applyMath").onclick=()=>{
      const col=el("mathColumn").value; if(!col) return;
      const op=el("mathOp").value; const val=parseFloat(el("mathValue").value)||0;
      const total=data.reduce((s,r)=>s+(parseFloat(r[col])||0),0);
      let result=total;
      if(op==="add") result+=val;
      if(op==="sub") result-=val;
      if(op==="mul") result*=val;
      if(op==="div"&&val!==0) result/=val;
      if(op==="perc"&&val!==0) result=(total/val)*100;
      el("mathResult").textContent="Result: "+result;
    };

    // Init
    load(); renderForm(); renderTable();
  </script>
</body>
</html>
